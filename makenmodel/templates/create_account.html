<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Make n' Model</title>
</head>
<body class="single-dark-background">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid px-5">
            <a href="{{ url_for('show_index') }}" class="navbar-brand">Make n' Model</a>
        </div>
    </nav>

    <!-- Create Account Box -->

    <!-- REVIEW: Need to figure out how to align the white box in the center vertically -->
    <div class="container d-flex justify-content-center">
        <div class="bg-white w-50 rounded">
            <div class="container">
                <div class="text-center">

                        <!-- TODO: Fix form action -->
                    <form action="#hello" class="needs-validation" novalidate>
                        <div class="m-3"><p class="text-dark fw-medium fs-2">Create Account</p></div>
                        <div class="mb-4">
                            <div class="text-start fs-5">
                                <label for="username" class="form-label">Create a username</label>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                <input type="text" class="form-control" id="username" placeholder="Username" required autofocus>

                                <div class="invalid-feedback">
                                    Please enter a username
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="text-start">
                                <label for="email_input_form" class="form-label fs-5">
                                    Enter your email address
                                </label>
                                <br>
                                <small class="text-muted">
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="text-warning">ONLY</span> used to reset your username/password if forgotten
                                </small>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                            <input type="email" class="form-control" id="email_input_form" placeholder="example@email.com" required>
                            <div class="invalid-feedback">
                                Invalid Email Address
                            </div>
                            </div>

                        </div>
                        <div class="mb-4">
                            <div class="text-start">
                                <label for="password_input_form" class="form-label fs-5">
                                    Create a password
                                </label>
                                <small class="text-muted">
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<ul>
                                        <li id="length_criteria">Between 6-20 characters</li>
                                        <li id="upper_criteria">Contains at least 1 capital letter</li>
                                        <li id="lower_criteria">Contains at least 1 lowercase letter</li>
                                        <li id="special_criteria">Contains at least 1 special charater</li>
                                    </ul>
                                </small>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-unlock-fill"></i></span>
                                <input type="password" class="form-control" id="password_input_form" placeholder="Password" required>
                                <div class="invalid-feedback">
                                    Invalid Password
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="text-start">
                                <label for="reenter_password" class="form-label fs-5">
                                    Re-Enter Password
                                </label>
                                <small class="text-muted">
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<ul>
                                        <li id="match_criteria">Passwords match</li>
                                    </ul>
                                </small>
                            </div>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                            <input type="password" class="form-control" id="reenter_password" placeholder="Re-Enter Passord" required>
                            <div class="invalid-feedback">
                                Passwords do not match
                            </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="text-start">
                                <label for="upload_photo" class="form-label fs-5">
                                    Upload a photo for your profile
                                    <span class="text-muted">(optional)</span>
                                </label>
                            </div>
                            <!-- TODO: Fix the profile photo upload -->
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-file-image-fill"></i></span>
                                <input type="file" class="form-control" id="formFile" placeholder="Upload Profile Picture">
                            </div>
                        </div>
                        <div class="m-3">
                            <!-- TODO: Button should make post to create account route -->
                            <button class="btn btn-dark col-12" type="submit">Create Account</a>
                        </div>
                    </form>

                    <!-- TODO: Button should redirect to create account page -->
                    <!-- REVIEW: Should link color be changed since yellow isn't super visibile? -->
                    <p class="text-dark">Already have an account? <a href="{{ url_for('show_login') }}" class="link-warning">Login</a></p>



                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var forms = document.querySelectorAll( ".needs-validation" );

            Array.prototype.slice.call( forms ).forEach( function( form )
            {
                form.addEventListener( "submit", function( event )
                {
                    if ( !form.checkValidity( ) || !validatePassword() || !validatePasswordMatch() )
                    {
                        event.preventDefault( );
                        event.stopPropagation( );
                    }
                    form.classList.add( "was-validated" );
                }, false );
            } );

            function validatePassword() {
                var password = document.getElementById("password_input_form").value;
                var lengthCriteria = document.getElementById("length_criteria");
                var upperCriteria = document.getElementById("upper_criteria");
                var lowerCriteria = document.getElementById("lower_criteria");
                var specialCriteria = document.getElementById("special_criteria");

                // Reset classes
                lengthCriteria.classList.remove("text-success");
                upperCriteria.classList.remove("text-success");
                lowerCriteria.classList.remove("text-success");
                specialCriteria.classList.remove("text-success");

                // Between 6-20 characters
                var lengthValid = password.length >= 6 && password.length <= 20;

                // Contains at least 1 uppercase letter
                var upperCaseValid = /[A-Z]/.test(password);

                // Contains at least 1 lowercase letter
                var lowerCaseValid = /[a-z]/.test(password);

                // Contains at least 1 special character
                var specialCharacterValid = /[!@#$%^&*]/.test(password);

                updateCriteria(lengthCriteria, lengthValid);
                updateCriteria(upperCriteria, upperCaseValid);
                updateCriteria(lowerCriteria, lowerCaseValid);
                updateCriteria(specialCriteria, specialCharacterValid);

                // Final combined validation check
                var isValidPassword = lengthValid && upperCaseValid && lowerCaseValid && specialCharacterValid;
                document.getElementById("password_input_form").setCustomValidity(isValidPassword ? "" : "Invalid password format");

                return isValidPassword;
            }

            function validatePasswordMatch() {
                var original_pass = document.getElementById("password_input_form").value;
                var reenter_password = document.getElementById("reenter_password").value;
                var matchCriteria = document.getElementById("match_criteria");

                var doPasswordsMatch = original_pass == reenter_password;

                updateCriteria(matchCriteria, doPasswordsMatch);

                document.getElementById("reenter_password").setCustomValidity(doPasswordsMatch ? "" : "Passwords do not match");

                return doPasswordsMatch
            }

            const passwordInput = document.getElementById("password_input_form");
            passwordInput.addEventListener("input", validatePassword);

            const matchInput = document.getElementById("reenter_password");
            matchInput.addEventListener("input", validatePasswordMatch);

            function updateCriteria(criteriaElement, isValid) {
                if(isValid) {
                    criteriaElement.classList.remove("text-danger");
                    criteriaElement.classList.add("text-success");
                } else {
                    criteriaElement.classList.remove("text-success");
                    criteriaElement.classList.add("text-danger");
                }
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>